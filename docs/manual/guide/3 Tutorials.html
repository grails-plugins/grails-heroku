<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <title>3 Tutorials 1.0</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8"/>
    <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8"/>
    <script type="text/javascript">
function addJsClass() {
    var classes = document.body.className.split(" ");
    classes.push("js");
    document.body.className = classes.join(" ");
}
    </script>
</head>

<body class="body" onload="addJsClass();">
<div id="navigation">
    <ul>
        <li>
            <div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)">
                <a href="../guide/index.html" class="button">Table of contents</a>

                <div id="nav-summary-childs" style="display:none;">
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/1%20Introduction%20to%20the%20Heroku%20Plugin.html"><strong>1</strong><span>Introduction to the Heroku Plugin</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/2%20Usage.html"><strong>2</strong><span>Usage</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/3%20Tutorials.html"><strong>3</strong><span>Tutorials</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/4%20Troubleshooting.html"><strong>4</strong><span>Troubleshooting</span></a>
                    </div>
                    
                </div>
            </div>
        </li>
        <li class="separator selected">
            <a id="ref-button" onclick="localToggle(); return false;" href="#">Quick Reference</a>
        </li>
    </ul>
</div>
<div id="header">
    <div class="images clearfix">
        
        
    </div>
    <p>Heroku Integration</p>
</div>


<table id="colset" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td id="col1">
            <div id="main" class="corner-all">

                
                    <div class="toc-item prev-left"><a href="../guide/2%20Usage.html">&lt;&lt; <strong>2</strong><span>Usage</span></a></div>
                

                <span id='toggle-col1' class="toggle">(<a href="#" onclick="localToggle(); return false;">Quick Reference</a>)</span>

                
                    <div class="toc-item next-right"><a href="../guide/4%20Troubleshooting.html"><strong>4</strong><span>Troubleshooting</span> >></a></div>
                


                <div class="project">
                    <h1>3 Tutorials - Reference Documentation</h1>

                    <p><strong>Authors:</strong> Burt Beckwith</p>

                    <p><strong>Version:</strong> 1.0</p>

                    
                </div>

                
                <div id="table-of-content">
                    <h2>Table of Contents</h2>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#3.1%20Basic%20Tutorial"><strong>3.1</strong><span>Basic Tutorial</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#3.2%20Advanced%20Tutorial"><strong>3.2</strong><span>Advanced Tutorial</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:10px"><a href="#3.2.1%20Database%20configuration"><strong>3.2.1</strong><span>Database configuration</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:10px"><a href="#3.2.2%20Heroku%20services"><strong>3.2.2</strong><span>Heroku services</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:10px"><a href="#3.2.3%20Memcached"><strong>3.2.3</strong><span>Memcached</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:10px"><a href="#3.2.4%20MongoDB"><strong>3.2.4</strong><span>MongoDB</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:10px"><a href="#3.2.5%20Redis"><strong>3.2.5</strong><span>Redis</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:10px"><a href="#3.2.6%20RabbitMQ"><strong>3.2.6</strong><span>RabbitMQ</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:10px"><a href="#3.2.7%20Tying%20it%20all%20together"><strong>3.2.7</strong><span>Tying it all together</span></a>
                    </div>
                    
                </div>
                

                

<h1 id="3 Tutorials">3 Tutorials</h1>
To make things more clear, try one or both of these tutorials. The first is a basic tutorial that gets you started with a simple application that uses a PostgreSQL database and some domain classes. The advanced tutorial is more extensive and includes examples of using NoSQL and messaging.


<h2 id="3.1 Basic Tutorial">3.1 Basic Tutorial</h2>
Here I assume you've got Grails 1.3.7 or 2.0.0 installed, along with Git and the Heroku command line client (as described in <a href="http://devcenter.heroku.com/articles/java" target="blank">Getting Started with Java on Heroku/Cedar</a>) and that you've authenticated to Heroku using the commandline client.<p class="paragraph"/>Do <strong class="bold">not</strong> create a pom.xml or Procfile.<p class="paragraph"/><h4>Create the application</h4><p class="paragraph"/><div class="code"><pre>$ grails create&#45;app herokutest
$ cd herokutest</pre></div><p class="paragraph"/><h4>Install the Heroku plugin</h4><p class="paragraph"/>Register a dependency on the plugin in <code>grails-app/conf/BuildConfig.groovy</code> in the <code>plugins</code> section:<p class="paragraph"/><div class="code"><pre>plugins &#123;
   compile ':heroku:1.0'
&#125;</pre></div><p class="paragraph"/><h4>Database configuration</h4><p class="paragraph"/>You don't need to change anything in <code>DataSource.groovy</code> since the plugin reconfigures the settings when the application starts up. The plugin will set the <code>driverClassName</code> to 'org.postgresql.Driver' and the <code>dialect</code> to <code>org.hibernate.dialect.PostgreSQLDialect</code>, and change the <code>url</code>, <code>username</code>, and <code>password</code> to the values detected from the system properties for your PostgreSQL instance.<p class="paragraph"/>You'll need the JDBC driver for the PostgreSQL database, so add a dependency for it in <code>BuildConfig.groovy</code>. Add the <code>mavenCentral()</code> repository (and optionally <code>mavenLocal()</code>):<p class="paragraph"/><div class="code"><pre>repositories &#123;
   grailsPlugins()
   grailsHome()
   grailsCentral()<p class="paragraph"/>   mavenLocal()
   mavenCentral()
&#125;</pre></div><p class="paragraph"/>and the jar dependency:<p class="paragraph"/><div class="code"><pre>dependencies &#123;
   runtime 'postgresql:postgresql:8.4&#45;702.jdbc3'
&#125;</pre></div><p class="paragraph"/>Add a couple of domain classes so we can test the database:<p class="paragraph"/><div class="code"><pre>$ grails create&#45;domain&#45;class database.Author
$ grails create&#45;domain&#45;class database.Book</pre></div><p class="paragraph"/>Edit the classes so they look like these:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">package</span> database<p class="paragraph"/>class Author &#123;
   <span class="java&#45;object">String</span> name<p class="paragraph"/>   <span class="java&#45;object">String</span> toString() &#123; name &#125;<p class="paragraph"/>   <span class="java&#45;keyword">static</span> hasMany = &#91;books: Book&#93;<p class="paragraph"/>   <span class="java&#45;keyword">static</span> mapping = &#123;
      cache <span class="java&#45;keyword">true</span>
   &#125;
&#125;</pre></div><p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">package</span> database<p class="paragraph"/>class Book &#123;
   <span class="java&#45;object">String</span> title<p class="paragraph"/>   <span class="java&#45;object">String</span> toString() &#123; title &#125;<p class="paragraph"/>   <span class="java&#45;keyword">static</span> belongsTo = &#91;author: Author&#93;<p class="paragraph"/>   <span class="java&#45;keyword">static</span> mapping = &#123;
      cache <span class="java&#45;keyword">true</span>
   &#125;
&#125;</pre></div><p class="paragraph"/>Generate CRUD controllers and views for the domain classes:<p class="paragraph"/><div class="code"><pre>$ grails generate&#45;all database.Author
$ grails generate&#45;all database.Book</pre></div><p class="paragraph"/><h4>Heroku and Git</h4><p class="paragraph"/>Heroku uses Git to deploy your application, so initialize a Git repository:<p class="paragraph"/><div class="code"><pre>$ git init</pre></div><p class="paragraph"/>and you'll need a .gitignore file. In 2.0 you can run<p class="paragraph"/><div class="code"><pre>$ grails integrate&#45;with &#45;&#45;git</pre></div><p class="paragraph"/>but in 1.3.7 you need to create your own, e.g.<p class="paragraph"/><div class="code"><pre>&#42;.iws
&#42;Db.properties
&#42;Db.script
.settings
stacktrace.log
target
/web&#45;app/plugins
/web&#45;app/WEB&#45;INF/classes</pre></div><p class="paragraph"/>Check your application code into your Git repo:<p class="paragraph"/><div class="code"><pre>$ git add .
$ git commit &#45;m <span class="java&#45;quote">"initial commit"</span></pre></div><p class="paragraph"/>Create the application at Heroku:<p class="paragraph"/><div class="code"><pre>$ heroku create &#45;&#45;stack cedar</pre></div><p class="paragraph"/>This will generate a random name for your application, e.g. "evening-fog-8924". Yours will be different so where you see "evening-fog-8924" be sure to replace it with the name assigned to you. You can verify that your application is available by viewing its details at <a href="../ref/Httpsapiherokucommyapps/https://api.heroku.com/myapps.html" class="https://api.heroku.com/myapps">https://api.heroku.com/myapps</a>.<p class="paragraph"/><h4>Deploy</h4><p class="paragraph"/>Deploying just involves pushing to the remote Git repository at Heroku:<p class="paragraph"/><div class="code"><pre>$ git push heroku master</pre></div><p class="paragraph"/>You'll see from the output that Heroku builds a war file from your project, including downloading dependencies and plugins. Once the push successfully completes you can view the log output with<p class="paragraph"/><div class="code"><pre>$ heroku logs</pre></div><p class="paragraph"/>and check status with<p class="paragraph"/><div class="code"><pre>$ heroku ps</pre></div><p class="paragraph"/>If the push fails you can fix the issues, commit, and try the push again.<p class="paragraph"/>If it worked, open the application in a browser by navigating to http://evening-fog-8924.herokuapp.com/ (replace "evening-fog-8924" with your actual application name).<p class="paragraph"/><h4>Updates</h4><p class="paragraph"/>When you update your code, run <code>git add</code> for the new and modified files, and commit. Then push again to the remote repo (<code>git push heroku master</code>) and your app will be stopped, rebuilt, and restarted.<p class="paragraph"/>


<h2 id="3.2 Advanced Tutorial">3.2 Advanced Tutorial</h2>
Here I assume you've got Grails 1.3.7 or 2.0.0 installed, along with Git and the Heroku command line client (as described in <a href="http://devcenter.heroku.com/articles/java" target="blank">Getting Started with Java on Heroku/Cedar</a>) and that you've authenticated to Heroku using the commandline client.<p class="paragraph"/>Do <strong class="bold">not</strong> create a pom.xml or Procfile.<p class="paragraph"/><h4>Create the application</h4><p class="paragraph"/><div class="code"><pre>$ grails create&#45;app herokutest
$ cd herokutest</pre></div><p class="paragraph"/><h4>Install the Heroku plugin</h4><p class="paragraph"/>Register a dependency on the plugin in <code>grails-app/conf/BuildConfig.groovy</code> in the <code>plugins</code> section:<p class="paragraph"/><div class="code"><pre>plugins &#123;
   &#8230;
   compile ':heroku:1.0'
   compile ':cloud-support:1.0.8'
&#125;</pre></div><p class="paragraph"/>


<h2 id="3.2.1 Database configuration">3.2.1 Database configuration</h2>
You don't need to change anything in <code>DataSource.groovy</code> since the plugin reconfigures the settings when the application starts up. The plugin will set the <code>driverClassName</code> to 'org.postgresql.Driver' and the <code>dialect</code> to <code>org.hibernate.dialect.PostgreSQLDialect</code>, and change the <code>url</code>, <code>username</code>, and <code>password</code> to the values detected from the system properties for your PostgreSQL instance.<p class="paragraph"/>You'll need the JDBC driver for the PostgreSQL database, so add a dependency for it in <code>BuildConfig.groovy</code>. Add the <code>mavenCentral()</code> repository (and optionally <code>mavenLocal()</code>):<p class="paragraph"/><div class="code"><pre>repositories &#123;
   grailsPlugins()
   grailsHome()
   grailsCentral()<p class="paragraph"/>   mavenLocal()
   mavenCentral()
&#125;</pre></div><p class="paragraph"/>and the jar dependency:<p class="paragraph"/><div class="code"><pre>dependencies &#123;
   runtime 'postgresql:postgresql:8.4&#45;702.jdbc3'
&#125;</pre></div><p class="paragraph"/>Add a couple of domain classes so we can test the database:<p class="paragraph"/><div class="code"><pre>$ grails create&#45;domain&#45;class database.Author
$ grails create&#45;domain&#45;class database.Book</pre></div><p class="paragraph"/>Edit the classes so they look like these:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">package</span> database<p class="paragraph"/>class Author &#123;
   <span class="java&#45;object">String</span> name<p class="paragraph"/>   <span class="java&#45;object">String</span> toString() &#123; name &#125;<p class="paragraph"/>   <span class="java&#45;keyword">static</span> hasMany = &#91;books: Book&#93;<p class="paragraph"/>   <span class="java&#45;keyword">static</span> mapping = &#123;
      cache <span class="java&#45;keyword">true</span>
   &#125;
&#125;</pre></div><p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">package</span> database<p class="paragraph"/>class Book &#123;
   <span class="java&#45;object">String</span> title<p class="paragraph"/>   <span class="java&#45;object">String</span> toString() &#123; title &#125;<p class="paragraph"/>   <span class="java&#45;keyword">static</span> belongsTo = &#91;author: Author&#93;<p class="paragraph"/>   <span class="java&#45;keyword">static</span> mapping = &#123;
      cache <span class="java&#45;keyword">true</span>
   &#125;
&#125;</pre></div><p class="paragraph"/>


<h2 id="3.2.2 Heroku services">3.2.2 Heroku services</h2>
Now we'll add some other supported services. These are all optional, but each has a free version so there's no risk in testing them out.<p class="paragraph"/>Heroku uses Git to deploy your application, so initialize a Git repository:<p class="paragraph"/><div class="code"><pre>$ git init</pre></div><p class="paragraph"/>We need to create the application at Heroku so we can attach the services:<p class="paragraph"/><div class="code"><pre>$ heroku create &#45;&#45;stack cedar</pre></div><p class="paragraph"/>This will generate a random name for your application, e.g. "evening-fog-8924". Yours will be different so where you see "evening-fog-8924" be sure to replace it with the name assigned to you. You can verify that your application is available by viewing its details at <a href="../ref/Httpsapiherokucommyapps/https://api.heroku.com/myapps.html" class="https://api.heroku.com/myapps">https://api.heroku.com/myapps</a>.<p class="paragraph"/>


<h2 id="3.2.3 Memcached">3.2.3 Memcached</h2>
To use Memcached as your Hibernate 2nd-level cache, add a dependency for the <code>memcached</code> plugin in <code>BuildConfig.groovy</code>:<p class="paragraph"/><div class="code"><pre>plugins &#123;
   &#8230;
   compile ':memcached:1.0.2'
&#125;</pre></div><p class="paragraph"/>(use the latest version; find the value at <a href="http://grails.org/plugin/memcached" target="blank">the plugin page</a>)<p class="paragraph"/>Also add the repositories for the plugin's dependencies:<p class="paragraph"/><div class="code"><pre>repositories &#123;
   &#8230;
   mavenRepo 'http://raykrueger.googlecode.com/svn/repository' // <span class="java&#45;keyword">for</span> hibernate&#45;memcached
   mavenRepo 'http://files.couchbase.com/maven2/'
&#125;</pre></div><p class="paragraph"/>and add an exclusion for ehcache since it's not needed:<p class="paragraph"/><div class="code"><pre>inherits('global') &#123;
   excludes 'ehcache'
&#125;</pre></div><p class="paragraph"/>Add the "memcache" service by running<p class="paragraph"/><div class="code"><pre>$ heroku addons:add memcache:5mb</pre></div><p class="paragraph"/>or you can choose a larger size if you want more capacity than the free version.<p class="paragraph"/>There are no configuration changes needed since the <code>heroku</code> plugin will configure things for you.<p class="paragraph"/>To see the new environment variables added for Memcached, run<p class="paragraph"/><div class="code"><pre>$ heroku config</pre></div><p class="paragraph"/>and the output should include something like<p class="paragraph"/><div class="code"><pre>MEMCACHE_PASSWORD =&#62; your_password
MEMCACHE_SERVERS  =&#62; mc123.ec456.northscale.net
MEMCACHE_USERNAME =&#62; app12345%40heroku.com</pre></div><p class="paragraph"/>


<h2 id="3.2.4 MongoDB">3.2.4 MongoDB</h2>
If you want to try MongoDB you have two options, "MongoLab" or "MongoHQ". Both are supported, so either run<p class="paragraph"/><div class="code"><pre>$ heroku addons:add mongolab:starter</pre></div><p class="paragraph"/>or<p class="paragraph"/><div class="code"><pre>$ heroku addons:add mongohq:free</pre></div><p class="paragraph"/>To see the new environment variables added for the Mongo service you chose, run<p class="paragraph"/><div class="code"><pre>$ heroku config</pre></div><p class="paragraph"/>and the output should include something like<p class="paragraph"/><div class="code"><pre>MONGOLAB_URI =&#62; mongodb://username:password&#64;server.mongolab.com:27567/heroku_app12345</pre></div><p class="paragraph"/>or<p class="paragraph"/><div class="code"><pre>MONGOHQ_URL =&#62; mongodb://username:password&#64;server.mongohq.com:10030/app12345</pre></div><p class="paragraph"/>Also add a dependency for the <code>mongodb</code> plugin in <code>BuildConfig.groovy</code>:<p class="paragraph"/><div class="code"><pre>plugins &#123;
   &#8230;
   compile ':mongodb:1.0.0.RC3'
&#125;</pre></div><p class="paragraph"/>(use the latest version; find the value at <a href="http://grails.org/plugin/mongodb" target="blank">the plugin page</a>)<p class="paragraph"/>There are no configuration changes needed since the <code>heroku</code> plugin will configure things for you.<p class="paragraph"/>Create a domain class to test Mongo:<p class="paragraph"/><div class="code"><pre>$ grails create&#45;domain&#45;class mongo.MongoThing</pre></div><p class="paragraph"/>Edit the class so it looks like this:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">package</span> mongo<p class="paragraph"/>class MongoThing &#123;
   <span class="java&#45;object">String</span> name
   <span class="java&#45;object">Integer</span> age
   Date dateCreated
   Date lastUpdated<p class="paragraph"/>   <span class="java&#45;keyword">static</span> mapWith = 'mongo'
&#125;</pre></div><p class="paragraph"/>


<h2 id="3.2.5 Redis">3.2.5 Redis</h2>
If you want to try Redis run<p class="paragraph"/><div class="code"><pre>$ heroku addons:add redistogo:nano</pre></div><p class="paragraph"/>To see the new environment variables added for the Redis service, run<p class="paragraph"/><div class="code"><pre>$ heroku config</pre></div><p class="paragraph"/>and the output should include something like<p class="paragraph"/><div class="code"><pre>REDISTOGO_URL =&#62; redis://redistogo:6652dc88c&#64;pike.redistogo.com:12345/</pre></div><p class="paragraph"/>Also add a dependency for the <code>redis-gorm</code> plugin in <code>BuildConfig.groovy</code>:<p class="paragraph"/><div class="code"><pre>plugins &#123;
   &#8230;
   compile ':redis&#45;gorm:1.0.0.M8'
&#125;</pre></div><p class="paragraph"/>(use the latest version; find the value at <a href="http://grails.org/plugin/redis-gorm" target="blank">the plugin page</a>)<p class="paragraph"/>There are no configuration changes needed since the <code>heroku</code> plugin will configure things for you.<p class="paragraph"/>Create a domain class to test Redis:<p class="paragraph"/><div class="code"><pre>$ grails create&#45;domain&#45;class redis.RedisThing</pre></div><p class="paragraph"/>Edit the class so it looks like this:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">package</span> redis<p class="paragraph"/>class RedisThing &#123;
   <span class="java&#45;object">String</span> name
   <span class="java&#45;object">Integer</span> age
   Date dateCreated
   Date lastUpdated<p class="paragraph"/>   <span class="java&#45;keyword">static</span> mapWith = 'redis'<p class="paragraph"/>   <span class="java&#45;keyword">static</span> mapping = &#123;
      name index: <span class="java&#45;keyword">true</span>
      age index: <span class="java&#45;keyword">true</span>
   &#125;
&#125;</pre></div><p class="paragraph"/>


<h2 id="3.2.6 RabbitMQ">3.2.6 RabbitMQ</h2>
If you want to try RabbitMQ ensure that your account has access to the private beta for RabbitMQ and run<p class="paragraph"/><div class="code"><pre>$ heroku addons:add rabbitmq</pre></div><p class="paragraph"/>To see the new environment variables added for the RabbitMQ service, run<p class="paragraph"/><div class="code"><pre>$ heroku config</pre></div><p class="paragraph"/>and the output should include something like<p class="paragraph"/><div class="code"><pre>RABBITMQ_URL =&#62; amqp://username:password&#64;server.rabbitmq.com:12345/virtualhost</pre></div><p class="paragraph"/>Also add a dependency for the <code>rabbitmq</code> plugin in <code>BuildConfig.groovy</code>:<p class="paragraph"/><div class="code"><pre>plugins &#123;
   &#8230;
   compile ':rabbitmq:0.3.2'
&#125;</pre></div><p class="paragraph"/>(use the latest version; find the value at <a href="http://grails.org/plugin/rabbitmq" target="blank">the plugin page</a>)<p class="paragraph"/>Because of the way the RabbitMQ plugin configures itself, we do need to make some small configuration changes. We can use placeholder values for the username, password, and hostname since the <code>heroku</code> plugin will update those. While we're here, let's also configure a queue to work with ("herokuQueue"). We'll update the <code>production</code> block in Config.groovy with the Heroku values, and the <code>development</code> block with local values:<p class="paragraph"/><div class="code"><pre>environments &#123;
   production &#123;
      rabbitmq &#123;
         connectionfactory &#123;
            username = 'placeholder'
            password = 'placeholder'
            hostname = 'placeholder'
            consumers = 5
         &#125;
         queues = &#123;
            herokuQueue()
         &#125;
      &#125;
   &#125;
   development &#123;
      rabbitmq &#123;
         connectionfactory &#123;
            username = 'guest'
            password = 'guest'
            hostname = 'localhost'
            consumers = 5
         &#125;
         queues = &#123;
            herokuQueue()
         &#125;
      &#125;
   &#125;
&#125;</pre></div><p class="paragraph"/>Create a service to receive messages and peek at the most recent:<p class="paragraph"/><div class="code"><pre>$ grails create&#45;service rabbit.Message</pre></div><p class="paragraph"/>Edit the class so it looks like this:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">package</span> rabbit<p class="paragraph"/>class MessageService &#123;<p class="paragraph"/>   <span class="java&#45;keyword">static</span> transactional = <span class="java&#45;keyword">false</span><p class="paragraph"/>   <span class="java&#45;keyword">static</span> rabbitQueue = 'herokuQueue'<p class="paragraph"/>   // not thread&#45;safe, just <span class="java&#45;keyword">for</span> demo
   List&#60;<span class="java&#45;object">String</span>&#62; mostRecentTextMessages = &#91;&#93;<p class="paragraph"/>   void handleMessage(<span class="java&#45;object">String</span> message) &#123;
      <span class="java&#45;keyword">try</span> &#123;
         log.info <span class="java&#45;quote">"Text message received at $&#123;<span class="java&#45;keyword">new</span> Date()&#125; $message"</span>
         mostRecentTextMessages &#60;&#60; message
         <span class="java&#45;keyword">while</span> (mostRecentTextMessages.size() &#62; 10) &#123;
            mostRecentTextMessages.remove 0
         &#125;
      &#125;
      <span class="java&#45;keyword">catch</span> (Throwable t) &#123;
         // demo only &#45; never <span class="java&#45;keyword">catch</span> Throwable!
         t.printStackTrace()
      &#125;
   &#125;
&#125;</pre></div><p class="paragraph"/>and a controller to send and view messages:<p class="paragraph"/><div class="code"><pre>$ grails create&#45;controller rabbit.Message</pre></div><p class="paragraph"/>Edit the class so it looks like this:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">package</span> rabbit<p class="paragraph"/>class MessageController &#123;<p class="paragraph"/>   def messageService<p class="paragraph"/>   def index = &#123;&#125;<p class="paragraph"/>   def sendMessage = &#123;
      rabbitSend 'herokuQueue', params.message
      flash.message = <span class="java&#45;quote">"Message sent: '$params.message'"</span>
      redirect action: 'viewMessages'
   &#125;<p class="paragraph"/>   def viewMessages = &#123;
      &#91;messages: messageService.mostRecentTextMessages&#93;
   &#125;
&#125;</pre></div><p class="paragraph"/>Create <code>grails-app/views/message/index.gsp</code> to send messages:<p class="paragraph"/><div class="code"><pre>&#60;html&#62;<p class="paragraph"/>&#60;head&#62;
&#60;meta http&#45;equiv=<span class="java&#45;quote">"Content&#45;Type"</span> content=<span class="java&#45;quote">"text/html; charset=UTF&#45;8"</span> /&#62;
&#60;meta name=<span class="java&#45;quote">"layout"</span> content=<span class="java&#45;quote">"main"</span> /&#62;
&#60;title&#62;RabbitMQ Messaging&#60;/title&#62;
&#60;/head&#62;<p class="paragraph"/>&#60;body&#62;
   &#60;div class=<span class="java&#45;quote">"nav"</span>&#62;
      &#60;span class=<span class="java&#45;quote">"menuButton"</span>&#62;
         &#60;a class=<span class="java&#45;quote">"home"</span> href=<span class="java&#45;quote">"$&#123;createLink(uri: '/')&#125;"</span>&#62;Home&#60;/a&#62;
      &#60;/span&#62;
   &#60;/div&#62;
   &#60;div class=<span class="java&#45;quote">"body"</span>&#62;
      &#60;h1&#62;Send Message&#60;/h1&#62;<p class="paragraph"/>      &#60;g:form action='sendMessage'&#62;
         &#60;div class=<span class="java&#45;quote">"dialog"</span>&#62;
            &#60;table&#62;
               &#60;tbody&#62;
                  &#60;tr class=<span class="java&#45;quote">"prop"</span>&#62;
                     &#60;td valign=<span class="java&#45;quote">"top"</span> class=<span class="java&#45;quote">"name"</span>&#62;
                       &#60;label <span class="java&#45;keyword">for</span>=<span class="java&#45;quote">"message"</span>&#62;Message&#60;/label&#62;
                     &#60;/td&#62;
                     &#60;td valign=<span class="java&#45;quote">"top"</span> class=<span class="java&#45;quote">"value"</span>&#62;
                        &#60;g:textField name=<span class="java&#45;quote">"message"</span>/&#62;
                     &#60;/td&#62;
                  &#60;/tr&#62;
               &#60;/tbody&#62;
            &#60;/table&#62;
         &#60;/div&#62;
         &#60;div class=<span class="java&#45;quote">"buttons"</span>&#62;
            &#60;span class=<span class="java&#45;quote">"button"</span>&#62;&#60;g:submitButton name=<span class="java&#45;quote">"Send"</span> /&#62;&#60;/span&#62;
         &#60;/div&#62;
      &#60;/g:form&#62;
   &#60;/div&#62;
&#60;/body&#62;
&#60;/html&#62;</pre></div><p class="paragraph"/>and <code>grails-app/views/message/viewMessages.gsp</code> to view messages:<p class="paragraph"/><div class="code"><pre>&#60;html&#62;<p class="paragraph"/>&#60;head&#62;
&#60;meta http&#45;equiv=<span class="java&#45;quote">"Content&#45;Type"</span> content=<span class="java&#45;quote">"text/html; charset=UTF&#45;8"</span> /&#62;
&#60;meta name=<span class="java&#45;quote">"layout"</span> content=<span class="java&#45;quote">"main"</span> /&#62;
&#60;title&#62;RabbitMQ Messaging&#60;/title&#62;
&#60;/head&#62;<p class="paragraph"/>&#60;body&#62;<p class="paragraph"/>   &#60;div class=<span class="java&#45;quote">"nav"</span>&#62;
      &#60;span class=<span class="java&#45;quote">"menuButton"</span>&#62;
         &#60;a class=<span class="java&#45;quote">"home"</span> href=<span class="java&#45;quote">"$&#123;createLink(uri: '/')&#125;"</span>&#62;Home&#60;/a&#62;
      &#60;/span&#62;
   &#60;/div&#62;<p class="paragraph"/>   &#60;div class=<span class="java&#45;quote">"body"</span>&#62;<p class="paragraph"/>      &#60;h1&#62;View Messages&#60;/h1&#62;<p class="paragraph"/>      &#60;g:<span class="java&#45;keyword">if</span> test=<span class="java&#45;quote">"$&#123;flash.message&#125;"</span>&#62;
      &#60;div class=<span class="java&#45;quote">"message"</span>&#62;$&#123;flash.message&#125;&#60;/div&#62;
      &#60;/g:<span class="java&#45;keyword">if</span>&#62;<p class="paragraph"/>      &#60;div class=<span class="java&#45;quote">"list"</span>&#62;
         &#60;ul&#62;
            &#60;g:each in=<span class="java&#45;quote">"$&#123;messages&#125;"</span> <span class="java&#45;keyword">var</span>=<span class="java&#45;quote">"m"</span>&#62;
            &#60;li&#62;$&#123;m.encodeAsHTML()&#125;&#60;/li&#62;
            &#60;/g:each&#62;
         &#60;/ul&#62;
      &#60;/div&#62;<p class="paragraph"/>   &#60;/div&#62;
&#60;/body&#62;
&#60;/html&#62;</pre></div><p class="paragraph"/>


<h2 id="3.2.7 Tying it all together">3.2.7 Tying it all together</h2>
We'll need a UI to view the domain classes, so run<p class="paragraph"/><div class="code"><pre>$ grails generate&#45;all <span class="java&#45;quote">"&#42;"</span></pre></div><p class="paragraph"/>to generate controllers and views for all of the domain classes.<p class="paragraph"/>Create an "info" controller that we can use to test the application's functionality:<p class="paragraph"/><div class="code"><pre>$ grails create&#45;controller info</pre></div><p class="paragraph"/>Edit the class so it looks like this:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">package</span> herokutest<p class="paragraph"/>class InfoController &#123;
   def index = &#123;
      &#91;env: <span class="java&#45;object">System</span>.getenv()&#93;
   &#125;
&#125;</pre></div><p class="paragraph"/>Optionally install the <a href="http://grails.org/plugin/console" target="blank">console</a> plugin to provide a web-based console that runs arbitrary Groovy code, and also the <a href="http://grails.org/plugin/dbconsole" target="blank">dbconsole</a> plugin (unless you're using 2.0 which has this feature built in). Add a reference to the console plugin in <code>BuildConfig.groovy</code>:<p class="paragraph"/><div class="code"><pre>plugins &#123;
   &#8230;
   compile ':console:1.0.1'
&#125;</pre></div><p class="paragraph"/>and if you're using 1.3.7 add a reference to the dbconsole plugin:<p class="paragraph"/><div class="code"><pre>plugins &#123;
   &#8230;
   compile ':dbconsole:1.1'
&#125;</pre></div><p class="paragraph"/>If you're using 2.0 you just need to enable it in the production environment since by default it's only enabled in development mode; enable it with the <code>grails.dbconsole.enabled</code> attribute in the production section of <code>Config.groovy</code>:<p class="paragraph"/><div class="code"><pre>production &#123;
   &#8230;
   grails.dbconsole.enabled = <span class="java&#45;keyword">true</span>
   &#8230;
&#125;</pre></div><p class="paragraph"/>If you're using 1.3.x add a dependency in <code>BuildConfig.groovy</code> for the <code>jquery</code> plugin so jQuery is available (it's automatically registered in 2.0 apps):<p class="paragraph"/><div class="code"><pre>plugins &#123;
   &#8230;
   compile ':jquery:1.7.1'
&#125;</pre></div><p class="paragraph"/><blockquote class="warning">
The GSP created here exposes a lot of information about your application and services, including passwords, a link to auto-login to a database console, and a web-based Groovy console that can run any arbitrary Groovy code. Be sure to guard access to your application with a security plugin, e.g. <a href="http://grails.org/plugin/spring-security-core/" target="blank">spring-security-core</a> or <a href="http://grails.org/plugin/shiro/" target="blank">Shiro</a>
</blockquote><p class="paragraph"/>Create <code>grails-app/views/info/index.gsp</code>:
<div class="code"><pre>&#60;html&#62;<p class="paragraph"/>&#60;head&#62;
  &#60;title&#62;Heroku Grails Test&#60;/title&#62;
  &#60;meta name='layout' content='main' /&#62;
  &#60;meta http&#45;equiv='Content&#45;Type' content='text/html; charset=UTF&#45;8' /&#62;
  &#60;style type=<span class="java&#45;quote">"text/css"</span> media=<span class="java&#45;quote">"screen"</span>&#62;<p class="paragraph"/>  &#35;nav &#123;
    margin&#45;top:20px;
    margin&#45;left:30px;
    width:228px;
    <span class="java&#45;object">float</span>:left;<p class="paragraph"/>  &#125;
  .homePagePanel &#42; &#123;
    margin:0px;
  &#125;
  .homePagePanel .panelBody ul &#123;
    list&#45;style&#45;type:none;
    margin&#45;bottom:10px;
  &#125;
  .homePagePanel .panelBody h1 &#123;
    text&#45;transform:uppercase;
    font&#45;size:1.1em;
    margin&#45;bottom:10px;
  &#125;
  .homePagePanel .panelBody &#123;
    background: url(images/leftnav_midstretch.png) repeat&#45;y top;
    margin:0px;
    padding:15px;
  &#125;
  .homePagePanel .panelBtm &#123;
    background: url(images/leftnav_btm.png) no&#45;repeat top;
    height:20px;
    margin:0px;
  &#125;<p class="paragraph"/>  .homePagePanel .panelTop &#123;
    background: url(images/leftnav_top.png) no&#45;repeat top;
    height:11px;
    margin:0px;
  &#125;
  h2 &#123;
    margin&#45;top:15px;
    margin&#45;bottom:15px;
    font&#45;size:1.2em;
  &#125;
  &#35;pageBody &#123;
    margin&#45;left:280px;
    margin&#45;right:20px;
  &#125;
  &#60;/style&#62;
&#60;/head&#62;<p class="paragraph"/>&#60;body&#62;<p class="paragraph"/>  &#60;body&#62;
    &#60;div id='nav'&#62;
      &#60;div class='homePagePanel'&#62;
        &#60;div class='panelTop'&#62;&#60;/div&#62;
        &#60;div class='panelBody'&#62;
          &#60;h1&#62;Application Status&#60;/h1&#62;
          &#60;ul&#62;
            &#60;li&#62;App version: &#60;g:meta name='app.version'/&#62;&#60;/li&#62;
            &#60;li&#62;Grails version: &#60;g:meta name='app.grails.version'/&#62;&#60;/li&#62;
            &#60;li&#62;Groovy version: $&#123;GroovySystem.version&#125;&#60;/li&#62;
            &#60;li&#62;JVM version: $&#123;<span class="java&#45;object">System</span>.getProperty('java.version')&#125;&#60;/li&#62;
            &#60;li&#62;Controllers: $&#123;grailsApplication.controllerClasses.size()&#125;&#60;/li&#62;
            &#60;li&#62;Domains: $&#123;grailsApplication.domainClasses.size()&#125;&#60;/li&#62;
            &#60;li&#62;Services: $&#123;grailsApplication.serviceClasses.size()&#125;&#60;/li&#62;
            &#60;li&#62;Tag Libraries: $&#123;grailsApplication.tagLibClasses.size()&#125;&#60;/li&#62;
          &#60;/ul&#62;
          &#60;h1&#62;Installed Plugins&#60;/h1&#62;
          &#60;ul&#62;
            &#60;g:each <span class="java&#45;keyword">var</span>='plugin' in='$&#123;applicationContext.pluginManager.allPlugins&#125;'&#62;
              &#60;li&#62;$&#123;plugin.name&#125; &#45; $&#123;plugin.version&#125;&#60;/li&#62;
            &#60;/g:each&#62;
          &#60;/ul&#62;
        &#60;/div&#62;
        &#60;div class='panelBtm'&#62;&#60;/div&#62;
      &#60;/div&#62;
    &#60;/div&#62;
    &#60;div id='pageBody'&#62;<p class="paragraph"/>      &#60;table&#62;
        &#60;thead&#62;
          &#60;tr&#62;&#60;th&#62;Name&#60;/th&#62;&#60;th&#62;Value&#60;/th&#62;&#60;/tr&#62;
        &#60;/thead&#62;
        &#60;tbody&#62;
          &#60;tr&#62;
            &#60;td&#62;DATABASE_URL&#60;/td&#62;
            &#60;td&#62;$&#123;env.DATABASE_URL&#125;&#60;/td&#62;
          &#60;/tr&#62;
          &#60;tr&#62;
            &#60;td&#62;RABBITMQ_URL&#60;/td&#62;
            &#60;td&#62;$&#123;env.RABBITMQ_URL&#125;&#60;/td&#62;
          &#60;/tr&#62;
          &#60;tr&#62;
            &#60;td&#62;REDISTOGO_URL&#60;/td&#62;
            &#60;td&#62;$&#123;env.REDISTOGO_URL&#125;&#60;/td&#62;
          &#60;/tr&#62;
          &#60;tr&#62;
            &#60;td&#62;MONGOHQ_URL&#60;/td&#62;
            &#60;td&#62;$&#123;env.MONGOHQ_URL&#125;&#60;/td&#62;
          &#60;/tr&#62;
          &#60;tr&#62;
            &#60;td&#62;MONGOLAB_URI&#60;/td&#62;
            &#60;td&#62;$&#123;env.MONGOLAB_URI&#125;&#60;/td&#62;
          &#60;/tr&#62;
          &#60;tr&#62;
            &#60;td&#62;MEMCACHE_SERVERS&#60;/td&#62;
            &#60;td&#62;$&#123;env.MEMCACHE_SERVERS&#125;&#60;/td&#62;
          &#60;/tr&#62;
          &#60;tr&#62;
            &#60;td&#62;MEMCACHE_USERNAME&#60;/td&#62;
            &#60;td&#62;$&#123;env.MEMCACHE_USERNAME&#125;&#60;/td&#62;
          &#60;/tr&#62;
          &#60;tr&#62;
            &#60;td&#62;MEMCACHE_PASSWORD&#60;/td&#62;
            &#60;td&#62;$&#123;env.MEMCACHE_PASSWORD&#125;&#60;/td&#62;
          &#60;/tr&#62;
        &#60;/tbody&#62;
      &#60;/table&#62;<p class="paragraph"/>&#60;g:javascript library=<span class="java&#45;quote">"jquery"</span> plugin=<span class="java&#45;quote">"jquery"</span> /&#62;<p class="paragraph"/>      &#60;div id='controllerList' class='dialog'&#62;
        &#60;h2&#62;Links:&#60;/h2&#62;
        &#60;ul&#62;
          &#60;li&#62;Hibernate:
            &#60;ul&#62;
              &#60;li class='controller'&#62;
                &#60;g:link controller='author'&#62;Author Controller&#60;/g:link&#62;
              &#60;/li&#62;
              &#60;li class='controller'&#62;
                &#60;g:link controller='book'&#62;Book Controller&#60;/g:link&#62;
              &#60;/li&#62;
            &#60;/ul&#62;
          &#60;/li&#62;
          &#60;li&#62;Redis:
            &#60;ul&#62;
              &#60;li class='controller'&#62;
                &#60;g:link controller='redisThing'&#62;Redis Domain <span class="java&#45;object">Class</span>&#60;/g:link&#62;
              &#60;/li&#62;
            &#60;/ul&#62;
          &#60;/li&#62;
          &#60;li&#62;Mongo:
            &#60;ul&#62;
              &#60;li class='controller'&#62;
                &#60;g:link controller='mongoThing'&#62;Mongo Domain <span class="java&#45;object">Class</span>&#60;/g:link&#62;
              &#60;/li&#62;
            &#60;/ul&#62;
          &#60;/li&#62;
          &#60;li&#62;Rabbit:
            &#60;ul&#62;
              &#60;li class='controller'&#62;
                &#60;g:link controller='message'&#62;Send a message&#60;/g:link&#62;
              &#60;/li&#62;
              &#60;li class='controller'&#62;
                &#60;g:link controller='message' action='viewMessages'&#62;View messages&#60;/g:link&#62;
              &#60;/li&#62;
            &#60;/ul&#62;
          &#60;/li&#62;
          &#60;li&#62;Admin:
            &#60;ul&#62;
              &#60;li class='controller'&#62;
                &#60;g:link controller='console'&#62;Console&#60;/g:link&#62;
              &#60;/li&#62;
              &#60;li class='controller'&#62;
                &#60;g:link controller='dbconsole'&#62;Database Console&#60;/g:link&#62;
              &#60;/li&#62;
              &#60;li class='controller'&#62;
                &#60;h:dbconsoleLink&#62;Database Console (autologin)&#60;/h:dbconsoleLink&#62;
              &#60;/li&#62;
            &#60;/ul&#62;
          &#60;/li&#62;
        &#60;/ul&#62;
      &#60;/div&#62;
    &#60;/div&#62;
  &#60;/body&#62;
&#60;/html&#62;</pre></div><p class="paragraph"/><h4>Logging</h4><p class="paragraph"/>You should probably turn on debug logging in Config.groovy for the various plugins, e.g.<p class="paragraph"/><div class="code"><pre>log4j = &#123;
   error 'org.codehaus.groovy.grails',
         'org.springframework',
         'org.hibernate',
         'net.sf.ehcache.hibernate'
   debug 'grails.plugin.heroku',
         'grails.plugin.memcached',
         'grails.plugin.cloudsupport'
&#125;</pre></div><p class="paragraph"/><h4>BootStrap</h4><p class="paragraph"/>If you don't want to use the auto-login dbconsole link but still have the database console available, you can add some code to <code>BootStrap.groovy</code> to display the connect information. You can also print out environment variables and system properties while you're there:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> grails.plugin.heroku.PostgresqlServiceInfo<p class="paragraph"/>class BootStrap &#123;<p class="paragraph"/>   def init = &#123; servletContext &#45;&#62;
      println <span class="java&#45;quote">"&#110;<span class="java&#45;object">System</span>.getenv():"</span>
      <span class="java&#45;object">System</span>.getenv().each &#123; name, value &#45;&#62;
         println <span class="java&#45;quote">"<span class="java&#45;object">System</span>.getenv($name): $value"</span>
      &#125;
      println <span class="java&#45;quote">"&#110;"</span>
      println <span class="java&#45;quote">"&#110;<span class="java&#45;object">System</span>.getProperties():"</span>
      <span class="java&#45;object">System</span>.getProperties().each &#123; name, value &#45;&#62;
         println <span class="java&#45;quote">"<span class="java&#45;object">System</span>.getProperty($name): $value"</span>
      &#125;
      println <span class="java&#45;quote">"&#110;"</span><p class="paragraph"/>      <span class="java&#45;object">String</span> DATABASE_URL = <span class="java&#45;object">System</span>.getenv('DATABASE_URL')
      <span class="java&#45;keyword">if</span> (DATABASE_URL) &#123;
         <span class="java&#45;keyword">try</span> &#123;
            PostgresqlServiceInfo info = <span class="java&#45;keyword">new</span> PostgresqlServiceInfo()
            println <span class="java&#45;quote">"&#110;PostgreSQL service ($DATABASE_URL): url='$info.url', "</span> +
                    <span class="java&#45;quote">"user='$info.username', password='$info.password'&#110;"</span>
         &#125;
         <span class="java&#45;keyword">catch</span> (e) &#123;
            println <span class="java&#45;quote">"Error occurred parsing DATABASE_URL: $e.message"</span>
         &#125;
      &#125;
   &#125;
&#125;</pre></div><p class="paragraph"/>Run
<div class="code"><pre>$ heroku logs</pre></div><p class="paragraph"/>after you've deployed your application to see this output.<p class="paragraph"/><h4>Git</h4><p class="paragraph"/>Heroku uses Git to deploy your application, so you'll need a .gitignore file. In 2.0 you can run<p class="paragraph"/><div class="code"><pre>$ grails integrate&#45;with &#45;&#45;git</pre></div><p class="paragraph"/>but in 1.3.7 you need to create your own, e.g.<p class="paragraph"/><div class="code"><pre>&#42;.iws
&#42;Db.properties
&#42;Db.script
.settings
stacktrace.log
target
/web&#45;app/plugins
/web&#45;app/WEB&#45;INF/classes</pre></div><p class="paragraph"/>Check your application code into your Git repo:<p class="paragraph"/><div class="code"><pre>$ git add .
$ git commit &#45;m <span class="java&#45;quote">"initial commit"</span></pre></div><p class="paragraph"/><h4>Deploy</h4><p class="paragraph"/>Deploying just involves pushing to the remote Git repository at Heroku:<p class="paragraph"/><div class="code"><pre>$ git push heroku master</pre></div><p class="paragraph"/>You'll see from the output that Heroku builds a war file from your project, including downloading dependencies and plugins. Once the push successfully completes you can view the log output with<p class="paragraph"/><div class="code"><pre>$ heroku logs</pre></div><p class="paragraph"/>and check status with<p class="paragraph"/><div class="code"><pre>$ heroku ps</pre></div><p class="paragraph"/>If the push fails you can fix the issues, commit, and try the push again.<p class="paragraph"/>If it worked, open the application in a browser by navigating to http://evening-fog-8924.herokuapp.com/ (replace "evening-fog-8924" with your actual application name). Open the "info" controller page that has all of the links to the functionality of the application by navigating to http://evening-fog-8924.herokuapp.com/info<p class="paragraph"/><h4>Updates</h4><p class="paragraph"/>When you update your code, run <code>git add</code> for the new and modified files and commit. Then push again to the remote repo (<code>git push heroku master</code>) and your app will be stopped, rebuilt, and restarted.<p class="paragraph"/>


                <div style="clear:both;margin-top:15px;"></div>
                
                    <div class="toc-item prev-left"><a href="../guide/2%20Usage.html">&lt;&lt; <strong>2</strong><span>Usage</span></a></div>
                
                    <div class="toc-item next-right"><a href="../guide/4%20Troubleshooting.html"><strong>4</strong><span>Troubleshooting</span> >></a></div>
                
                <div style="clear:both"></div>
            </div>
        </td>
        <td id="col2">
            <div class="local clearfix">
                <div class="local-title">
                    <a href="../guide/index.html" target="mainFrame">Quick Reference</a>
                    <span class="toggle">(<a href="#" onclick="localToggle(); return false;">hide</a>)</span>
                </div>
                <div class="menu">
                    
                </div>
            </div>
        </td>
    </tr>
</table>

<div id="footer">
    
    
</div>

<script type="text/javascript" src="../js/docs.js"></script>


<script type="text/javascript">
	var _gaq = _gaq || [];
	_gaq.push(['_setAccount', 'UA-16219500-1']);
	_gaq.push(['_trackPageview']);

	(function() {
		var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	})();
</script>
</body>
</html>
